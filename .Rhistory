library(tidyverse)
library(here)
data <- read_csv(here("02_data", "avocado", "avocado.csv"))
View(data)
data <- data %>%
clean_names() %>%
rename(id = "x_1")
library(janitor)
data <- data %>%
clean_names() %>%
rename(id = "x_1")
View(data)
data <- data %>%
clean_names() %>%
rename(id = "x1")
View(data)
data <- read_csv(here("02_data", "avocado", "avocado.csv"))
View(data)
?clean_names
View(data)
library(lubridate)
?weeks
data <- data %>%
clean_names() %>%
rename(id = "x1") %>%
mutate(week = floor_date(date, unit = "weeks"))
View(data)
unique(data$week)
unique(data$data)
unique(data$date)
unique(data$date) %>% sort()
data$week == data$date
any(data$week == data$date)
View(data)
data %>% group_by(date) %>% summarize(sum(total_volume))
data %>% group_by(date) %>% summarize(sum(total_volume)) %>% View()
data %>% count(date)
data %>% group_by(date) %>% summarize(sum_volume = sum(total_volume)) %>%
ggplot(aes(x = sum_volume)) +
geom_histogram()
options(scipen = 999)
data %>% group_by(date) %>% summarize(sum_volume = sum(total_volume)) %>%
ggplot(aes(x = sum_volume)) +
geom_histogram()
data %>% group_by(date) %>% summarize(sum(Large Bags)) %>% View()
data %>% group_by(date) %>% summarize(sum(Large_bags)) %>% View()
data %>% group_by(date) %>% summarize(sum(large_bags)) %>% View()
glimpse(data)
data %>%  mutate(total_volume / total_bags)
data %>%  mutate(total_volume / total_bags) %>%  View()
data %>%  mutate(total_volume * 100 / total_bags * 100) %>%  View()
data %>%  mutate((total_volume * 100) / (total_bags * 100)) %>%  View()
data$total_volume * 100
data %>% group_by(date) %>% summarize(sum(total_volume * 100)) %>% View()
(8467433720 * 6) / 16
(84674337.20 * 6) / 16
data %>% group_by(date) %>% summarize(sum((total_volume * 6) / 16)) %>% View()
data %>% group_by(date) %>% summarize(sum = sum((total_volume * 6) / 16)) %>% ggplot(aes(x = sum )) + geom_histogram()
data %>% glimpse()
data %>% select(x4046:x_large_bags) %>%  rowSums()
data %>% transmute(total = total_volume,
other_sum = select(., x4046:x_large_bags) %>% rowSums())
data %>% transmute(total = total_volume,
other_sum = select(., x4046:x4770, small_bags:x_large_bags) %>% rowSums())
data %>% transmute(total = total_volume,
bags_sum = select(., x4046:x4770, total_bags) %>%  rowSums(),
other_sum = select(., x4046:x4770, small_bags:x_large_bags) %>% rowSums())
data <- read_csv(here("02_data", "avocado", "avocado.csv"))
data <- read_csv(here::here("02_data", "avocado", "avocado.csv"))
data <- data %>%
clean_names() %>%
rename(id = "x1")
data <- data %>%
clean_names() %>%
rename(id = "x1")
View(data)
data <- data %>%
clean_names() %>%
rename(id = "x1") %>%
select(-c(total_volume, total_bags))
data <- read_csv(here::here("02_data", "avocado", "avocado.csv"))
data <- data %>%
clean_names() %>%
rename(id = "x1") %>%
select(-c(total_volume, total_bags))
View(data)
names(data)
data <- data %>%
clean_names() %>%
rename(id = "x1") %>%
select(-c(total_volume, total_bags)) %>%
rename(small = x4046,
medium = x4225,
large = x4770)
data <- read_csv(here::here("02_data", "avocado", "avocado.csv"))
data <- data %>%
clean_names() %>%
rename(id = "x1") %>%
select(-c(total_volume, total_bags)) %>%
rename(small = x4046,
medium = x4225,
large = x4770)
View(data)
data <- read_csv(here::here("02_data", "avocado", "avocado.csv"))
data <- data %>%
clean_names() %>%
rename(id = "x1") %>%
select(-c(total_volume, total_bags)) %>%
rename(small = x4046,
medium = x4225,
large = x4770) %>%
gather(kind, volume, small:x_large_bags)
View(data)
data %>% group_by(id) %>% summarize(total = sum(volume))
data <- data %>%
clean_names() %>%
select(-c(total_volume, total_bags)) %>%
rename(small = x4046,
medium = x4225,
large = x4770) %>%
gather(kind, volume, small:x_large_bags)
View(data)
rename(small = x4046,
medium = x4225,
large = x4770) %>%
gather(kind, volume, small:x_large_bags)
data <- data %>%
clean_names() %>%
select(-c(X1, total_volume, total_bags)) %>%
mutate(id = 1:nrow(.))
data <- read_csv(here::here("02_data", "avocado", "avocado.csv"))
data <- data %>%
clean_names() %>%
select(-c(X1, total_volume, total_bags)) %>%
mutate(id = 1:nrow(.))
View(data)
data <- data %>%
clean_names() %>%
select(-c(x1, total_volume, total_bags)) %>%
mutate(id = 1:nrow(.))
View(data)
rename(small = x4046,
medium = x4225,
large = x4770) %>%
gather(kind, volume, small:x_large_bags)
data <- data %>%
clean_names() %>%
select(-c(x1, total_volume, total_bags)) %>%
mutate(id = 1:nrow(.)) %>%
rename(small = x4046,
medium = x4225,
large = x4770) %>%
gather(kind, volume, small:x_large_bags)
data <- read_csv(here::here("02_data", "avocado", "avocado.csv"))
data <- data %>%
clean_names() %>%
select(-c(x1, total_volume, total_bags)) %>%
mutate(id = 1:nrow(.)) %>%
rename(small = x4046,
medium = x4225,
large = x4770) %>%
gather(kind, volume, small:x_large_bags)
View(data)
data %>% group_by(id) %>% summarize(total = sum(volume))
data <- read_csv(here::here("02_data", "avocado", "avocado.csv"))
View(data)
data <- data %>%
clean_names() %>%
select(-c(x1, total_volume, total_bags)) %>%
mutate(id = 1:nrow(.)) %>%
select(id, everything()) %>%
rename(small = x4046,
medium = x4225,
large = x4770) %>%
gather(kind, volume, small:x_large_bags)
View(data)
read_csv(here::here("02_data", "avocado", "avocado.csv"))
View(data)
data %>% group_by(id) %>% summarize(total = sum(volume))
View(data)
install.packages("dplyr")
install.packages("dplyr")
install.packages("dplyr")
install.packages("dplyr")
install.packages("dplyr")
install.packages("dplyr")
install.packages("dplyr")
library(tidyverse)
library(here)
library(janitor)
names(data)
data <- data %>%
clean_names() %>%
select(-c(x1, total_volume, total_bags)) %>%
mutate(id = 1:nrow(.)) %>%
select(id, everything()) %>%
rename(small = x4046,
medium = x4225,
large = x4770) %>%
gather(kind, volume, small:x_large_bags) %>%
select(id, date, region, type, kind, volume, average_price)
data <- read_csv(here::here("02_data", "avocado", "avocado.csv"))
data <- data %>%
clean_names() %>%
select(-c(x1, total_volume, total_bags)) %>%
mutate(id = 1:nrow(.)) %>%
select(id, everything()) %>%
rename(small = x4046,
medium = x4225,
large = x4770) %>%
gather(kind, volume, small:x_large_bags) %>%
select(id, date, region, type, kind, volume, average_price)
View(data)
library(tidyverse)
library(here)
library(janitor)
data <- read_csv(here::here("02_data", "avocado", "avocado_raw.csv"))
split_camel <- function(string_to_split) {
paste(unlist(strsplit(string_to_split, "(?<=[a-z])(?=[A-Z])", perl = TRUE)), collapse = " ")
}
# Long format
data_long <- data %>%
clean_names() %>%
select(-c(x1, total_volume, total_bags)) %>%
mutate(id = 1:nrow(.)) %>%
select(id, everything()) %>%
rename(small = x4046,
medium = x4225,
large = x4770) %>%
gather(kind, volume, small:x_large_bags) %>%
select(id, date, region, type, kind, volume, average_price) %>%
mutate(region = map_chr(region, split_camel))
View(data_long)
geocodes
regions_unique <- data$region %>% unique()
geocodes <- regions_unique %>%  geocode_OSM()
library(tmaptools)
regions_unique_clean <- map_chr(regions_unique, split_camel)
geocodes <- regions_unique_clean %>% geocode_OSM()
geocodes
write_csv(data_long, here::here("02_data", "avocado", "avocado_long.csv"), na = "")
geocodes[,1:3]
# Long format
data_long <- data %>%
clean_names() %>%
select(-c(x1, total_volume, total_bags)) %>%
mutate(id = 1:nrow(.)) %>%
select(id, everything()) %>%
rename(small = x4046,
medium = x4225,
large = x4770) %>%
gather(kind, volume, small:x_large_bags) %>%
select(id, date, region, type, kind, volume, average_price) %>%
mutate(region = map_chr(region, split_camel)) %>%
left_join(geocodes[, 1:3], by = c("region" = "query"))
View(data_long)
write_csv(data_long, here::here("02_data", "avocado", "avocado_long.csv"), na = "")
library(tidyverse)
library(readxl)
library(here)
library(conflicted)
library(janitor)
library(countrycode)
conflict_prefer("here", "here")
conflict_prefer("filter", "dplyr")
data <- read_excel(here("02_data", "wdi", "world_development_indicators_raw.xlsx")) %>%
clean_names()
indicators <- c("GDP per capita (current US$)",
"Fertility rate, total (births per woman)",
"Mortality rate, infant (per 1,000 live births)",
"Life expectancy at birth, total (years)",
"Literacy rate, adult total (% of people ages 15 and above)",
"Population, total",
"CO2 emissions (metric tons per capita)",
"Energy use (kg of oil equivalent per capita)",
"Renewable energy consumption (% of total final energy consumption)",
"Fossil fuel energy consumption (% of total)",
"Energy related methane emissions (% of total)")
data_clean <- data %>%
filter(indicator_name %in% indicators) %>%
select(-c(indicator_code, country_code)) %>%
gather(year, value, -c(country_name, indicator_name)) %>%
mutate(year = str_remove(year, "x")) %>%
spread(indicator_name, value) %>%
clean_names() %>%
filter(as.numeric(year) <= 2014) %>%
rename(gdp_per_capita_current_usd = gdp_per_capita_current_us) %>%
mutate(country_name = str_replace(country_name, "Russian Federation", "Russia") %>%
str_replace("Russian Federation", "Russia") %>%
str_replace("Korea, Rep.", "South Korea") %>%
str_replace("Congo, Dem. Rep.", "Republic Congo") %>%
str_replace("Korea, Dem. Peopleâ€™s Rep.", "North Korea") %>%
str_extract("[a-zA-Z\\s]+(?=,?)")) %>%
filter(country_name %in% c(codelist$country.name.en,
"Czech Republic",
"Myanmar",
"North Macedonia",
"Syrian Arab Republic",
"Kyrgyz Republic",
"Bosnia and Herzegovina",
"Republic Congo",
"South Korea",
"North Korea"))  %>%
left_join(codelist[,c("country.name.en", "continent")],
by = c("country_name" = "country.name.en")) %>%
mutate(continent = case_when(country_name == "Bosnia and Herzegovina" ~ "Europe",
country_name == "Czech Republic" ~ "Europe",
country_name == "Kosovo" ~ "Europe",
country_name == "Kyrgyz Republic" ~ "Asia",
country_name == "Myanmar" ~ "Asia",
country_name == "North Macedonia" ~ "Europe",
country_name == "Syrian Arab Republic" ~ "Asia",
country_name == "Russia" ~ "Asia",
country_name == "Republic Congo" ~ "Africa",
country_name == "South Korea" ~ "Asia",
country_name == "North Korea" ~ "Asia",
TRUE ~ continent
))
write_csv(data_clean,
here("02_data", "wdi", "world_development_indicators_clean.csv"),
na = "")
78 * 4.6
89 *81
